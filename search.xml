<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Arch Linux 初始网络配置指南</title>
      <link href="/2025/01/13/Arch%20Linux%20%E5%88%9D%E5%A7%8B%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/"/>
      <url>/2025/01/13/Arch%20Linux%20%E5%88%9D%E5%A7%8B%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<h1 id="Arch-Linux-初始网络配置指南：从网络中断到顺畅联网"><a href="#Arch-Linux-初始网络配置指南：从网络中断到顺畅联网" class="headerlink" title="Arch Linux 初始网络配置指南：从网络中断到顺畅联网"></a>Arch Linux 初始网络配置指南：从网络中断到顺畅联网</h1><p>本文档旨在解决 Arch Linux 基础安装后常见的网络连接问题，并指导用户完成从临时网络配置到现代化网络管理的完整流程。</p><hr><h3 id="一、问题现象"><a href="#一、问题现象" class="headerlink" title="一、问题现象"></a>一、问题现象</h3><p>在 Arch Linux 虚拟机完成基础安装后，执行以下操作时出现典型网络故障：</p><ol><li><p><strong>尝试更新系统时失败</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pacman -Syu</span></span><br><span class="line">error: failed retrieving file <span class="string">&#x27;core.db&#x27;</span> from mirrors...</span><br><span class="line">warning: failed to retrieve some files</span><br></pre></td></tr></table></figure></li><li><p><strong>尝试进行域名解析时失败</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ping archlinux.org</span></span><br><span class="line">ping: archlinux.org: Temporary failure <span class="keyword">in</span> name resolution</span><br></pre></td></tr></table></figure></li></ol><p>此时，系统虽然具备基础网络功能，但无法访问互联网资源，表现为软件源连接失败和 DNS 解析错误。</p><hr><h3 id="二、根本原因分析"><a href="#二、根本原因分析" class="headerlink" title="二、根本原因分析"></a>二、根本原因分析</h3><p>通过分层排查，我们可以定位问题的根源：</p><table><thead><tr><th align="left">网络层次</th><th align="left">命令&#x2F;操作</th><th align="left">现象&#x2F;输出</th><th align="left">结论</th></tr></thead><tbody><tr><td align="left"><strong>应用层</strong></td><td align="left"><code>pacman -Syu</code></td><td align="left"><code>failed retrieving file</code></td><td align="left">无法访问软件源</td></tr><tr><td align="left"><strong>DNS 解析层</strong></td><td align="left"><code>ping archlinux.org</code></td><td align="left"><code>Temporary failure in name resolution</code></td><td align="left">DNS 配置缺失或错误</td></tr><tr><td align="left"><strong>网络管理服务</strong></td><td align="left"><code>systemctl status NetworkManager</code></td><td align="left"><code>Unit NetworkManager.service could not be found</code></td><td align="left">未安装网络管理工具</td></tr><tr><td align="left"><strong>物理链路层</strong></td><td align="left"><code>ip link show</code></td><td align="left"><code>ens33: DOWN</code></td><td align="left">网卡处于关闭（DOWN）状态</td></tr></tbody></table><p><strong>核心矛盾</strong>：系统因未安装网络管理服务（如 NetworkManager）而无法自动配置网络；而安装网络管理工具又必须依赖网络连接。这形成了一个典型的“初始网络配置死锁”。</p><hr><h3 id="三、解决方案"><a href="#三、解决方案" class="headerlink" title="三、解决方案"></a>三、解决方案</h3><p>我们将分三个阶段解决此问题：</p><ol><li><strong>第一阶段</strong>：手动启用 <code>systemd-networkd</code> 服务，建立临时网络连接。</li><li><strong>第二阶段</strong>：解决 <code>pacman</code> 镜像源访问缓慢或失败的问题。</li><li><strong>第三阶段</strong>：安装并切换到功能更强大的 <code>NetworkManager</code> 作为永久网络方案。</li></ol><h4 id="第一阶段：激活网卡并配置-systemd-networkd"><a href="#第一阶段：激活网卡并配置-systemd-networkd" class="headerlink" title="第一阶段：激活网卡并配置 systemd-networkd"></a><strong>第一阶段：激活网卡并配置 systemd-networkd</strong></h4><p>这是解决问题的核心步骤。我们将手动激活网卡，并使用系统内置的 <code>systemd-networkd</code> 服务来自动获取 IP 和 DNS。</p><ol><li><p><strong>激活网络接口</strong><br>运行以下命令，将名为 <code>ens33</code> 的网卡从 <code>DOWN</code> 状态切换为 <code>UP</code> 状态。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> ens33 up</span><br></pre></td></tr></table></figure></li><li><p><strong>创建网络配置文件</strong><br>使用 <code>nano</code> 编辑器创建一个新的网络配置文件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/systemd/network/20-wired.network</span><br></pre></td></tr></table></figure><blockquote><p><strong>提示</strong>：如果提示目录 <code>/etc/systemd/network</code> 不存在，请先创建它：<code>mkdir -p /etc/systemd/network</code></p></blockquote></li><li><p><strong>写入配置内容</strong><br>在打开的 <code>nano</code> 编辑器中，输入以下内容。这会告诉系统对 <code>ens33</code> 接口使用 DHCP（动态主机配置协议）来自动获取网络配置。</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Match]</span></span><br><span class="line"><span class="attr">Name</span>=ens33</span><br><span class="line"></span><br><span class="line"><span class="section">[Network]</span></span><br><span class="line"><span class="attr">DHCP</span>=<span class="literal">yes</span></span><br></pre></td></tr></table></figure><p>完成后，按 <code>Ctrl+X</code> 保存，接着按 <code>Y</code> 确认，最后按 <code>Enter</code> 退出。</p></li><li><p><strong>启动网络与 DNS 服务</strong><br>启动 <code>systemd-networkd</code> (负责网络连接) 和 <code>systemd-resolved</code> (负责 DNS 解析) 两个核心服务。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start systemd-networkd</span><br><span class="line">systemctl start systemd-resolved</span><br></pre></td></tr></table></figure></li><li><p><strong>配置 DNS 解析文件</strong><br>这是确保域名能被正确解析的关键一步。运行以下命令，将系统的 DNS 解析配置链接到 <code>systemd-resolved</code> 生成的配置文件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -sf /run/systemd/resolve/stub-resolv.conf /etc/resolv.conf</span><br></pre></td></tr></table></figure></li><li><p><strong>验证网络连接</strong><br>稍等几秒钟，然后测试网络。如果一切顺利，你应该能看到来自服务器的回应。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping archlinux.org</span><br></pre></td></tr></table></figure><p>看到回应后，按 <code>Ctrl+C</code> 停止 ping。这表示临时网络已成功建立。</p></li></ol><hr><h4 id="第二阶段：尝试安装-NetworkManager-并解决软件源问题"><a href="#第二阶段：尝试安装-NetworkManager-并解决软件源问题" class="headerlink" title="第二阶段：尝试安装 NetworkManager 并解决软件源问题"></a><strong>第二阶段：尝试安装 NetworkManager 并解决软件源问题</strong></h4><ol><li><strong>尝试安装 NetworkManager</strong><br>现在，你的系统已经临时联网。尝试安装 <code>NetworkManager</code>：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -Syu networkmanager</span><br></pre></td></tr></table></figure>此时，你可能会遇到类似以下的问题：</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Total (6/22)</span><br><span class="line">error: failed retrieving file &#x27;...&#x27; from mirror.u-nds.com</span><br></pre></td></tr></table></figure><p><strong>问题根源</strong>：<code>pacman</code> 默认的镜像列表 <code>/etc/pacman.d/mirrorlist</code> 包含了世界各地的服务器。当前连接的服务器可能访问速度慢、暂时离线或文件不完整。</p><p><strong>解决方案</strong>：使用 <code>reflector</code> 工具自动筛选出最快、最新的镜像服务器。</p><ol><li><p><strong>检查并同步系统时间（非常重要）</strong><br>不正确的系统时间会导致 HTTPS 证书验证和软件包签名验证失败。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查当前时间状态</span></span><br><span class="line">timedatectl status</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用网络时间同步（NTP），让系统自动校准时间</span></span><br><span class="line">timedatectl set-ntp <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>再次运行 <code>timedatectl status</code> 确认时间正确。</p></li><li><p><strong>安装 reflector 工具</strong><br>利用当前临时的网络连接安装 <code>reflector</code>。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -S reflector</span><br></pre></td></tr></table></figure><blockquote><p>如果此命令失败，请多试几次。<code>reflector</code> 包很小，通常很容易成功。</p></blockquote></li><li><p><strong>使用 <code>reflector</code> 生成最优镜像列表</strong><br>a. <strong>备份原始镜像列表</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /etc/pacman.d/mirrorlist /etc/pacman.d/mirrorlist.backup</span><br></pre></td></tr></table></figure><p>b. <strong>运行 <code>reflector</code></strong>（此命令专为中国用户优化）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reflector --country China --age 12 --protocol https --<span class="built_in">sort</span> rate --save /etc/pacman.d/mirrorlist</span><br></pre></td></tr></table></figure><ul><li><code>--country China</code>: 只筛选中国的镜像服务器。</li><li><code>--age 12</code>: 只选择过去12小时内同步过的最新服务器。</li><li><code>--protocol https</code>: 只使用安全的 HTTPS 协议。</li><li><code>--sort rate</code>: 按下载速度从快到慢排序。</li><li><code>--save ...</code>: 将生成的最优列表直接保存到 <code>mirrorlist</code> 文件中。</li></ul></li></ol><hr><h4 id="第三阶段：安装并切换到-NetworkManager"><a href="#第三阶段：安装并切换到-NetworkManager" class="headerlink" title="第三阶段：安装并切换到 NetworkManager"></a><strong>第三阶段：安装并切换到 NetworkManager</strong></h4><p>现在，我们拥有了稳定的网络和高速的镜像源，可以正式安装并切换到现代化的网络管理器 <code>NetworkManager</code>。</p><ol><li><p><strong>强制刷新软件库并安装 NetworkManager</strong><br>使用 <code>-Syyu</code> 参数强制 <code>pacman</code> 从新的镜像列表同步数据库。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -Syyu networkmanager</span><br></pre></td></tr></table></figure><p>这一次，下载过程应该会非常流畅。</p></li><li><p><strong>停用并禁用临时服务</strong><br>为避免冲突，停用并禁用之前手动启动的 <code>systemd</code> 相关服务。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop systemd-networkd</span><br><span class="line">systemctl stop systemd-resolved</span><br><span class="line">systemctl <span class="built_in">disable</span> systemd-networkd</span><br><span class="line">systemctl <span class="built_in">disable</span> systemd-resolved</span><br></pre></td></tr></table></figure></li><li><p><strong>启动并启用 NetworkManager</strong><br>让 <code>NetworkManager</code> 接管网络，并设置为开机自启。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start NetworkManager</span><br><span class="line">systemctl <span class="built_in">enable</span> NetworkManager</span><br></pre></td></tr></table></figure></li></ol><hr><h3 id="四、最终验证"><a href="#四、最终验证" class="headerlink" title="四、最终验证"></a>四、最终验证</h3><ol><li><p><strong>检查 NetworkManager 状态</strong><br>确认服务正在正常运行。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status NetworkManager</span><br></pre></td></tr></table></figure><p>你应该会看到绿色的 <code>active (running)</code> 字样。</p></li><li><p><strong>最后一次 ping 测试</strong><br>确认网络连接和 DNS 解析均正常。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping baidu.com</span><br></pre></td></tr></table></figure></li></ol><p>至此，你已成功完成从网络中断、DNS 解析失败、软件源缓慢到成功安装并配置 <code>NetworkManager</code> 的全部过程。你的 Arch Linux 现在拥有了稳定、高效的网络连接。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Arch Linux </tag>
            
            <tag> 网络配置 </tag>
            
            <tag> NetworkManager </tag>
            
            <tag> systemd-networkd </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Arch Linux 虚拟机安装指南</title>
      <link href="/2025/01/13/Arch%20Linux%20%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/"/>
      <url>/2025/01/13/Arch%20Linux%20%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<p>本指南将详细引导您在虚拟机中完成 Arch Linux 的安装与配置，并完整保留了操作过程中的详细步骤与说明。</p><hr><h2 id="一、准备工作"><a href="#一、准备工作" class="headerlink" title="一、准备工作"></a>一、准备工作</h2><h3 id="步骤-1：下载-Arch-Linux-ISO-镜像"><a href="#步骤-1：下载-Arch-Linux-ISO-镜像" class="headerlink" title="步骤 1：下载 Arch Linux ISO 镜像"></a>步骤 1：下载 Arch Linux ISO 镜像</h3><p>首先，您需要从官方网站获取 Arch Linux 的安装镜像 (ISO 文件)。这是最安全可靠的来源。</p><ul><li><strong>官方下载页面：</strong> <a href="https://archlinux.org/download/">https://archlinux.org/download/</a></li></ul><blockquote><p><strong>如何选择下载链接？</strong><br>在下载页面，向下滚动找到 <strong>“HTTP Direct Downloads”</strong> 部分。这里列出了全球各地的镜像服务器。为获得最佳下载速度，建议中国大陆用户选择 “China” 分类下的镜像站点，例如：</p><ul><li><strong>清华大学开源软件镜像站:</strong> <code>https://mirrors.tuna.tsinghua.edu.cn/archlinux/iso/latest/</code></li><li><strong>中国科学技术大学开源软件镜像站:</strong> <code>https://mirrors.ustc.edu.cn/archlinux/iso/latest/</code></li></ul><p>进入镜像站点后，点击以 <code>.iso</code> 结尾的最新文件（如 <code>archlinux-2025.08.01-x86_64.iso</code>）即可开始下载。</p></blockquote><h3 id="步骤-2：配置虚拟机"><a href="#步骤-2：配置虚拟机" class="headerlink" title="步骤 2：配置虚拟机"></a>步骤 2：配置虚拟机</h3><p>在您的虚拟化软件（如 VMware, VirtualBox）中创建一个新的虚拟机。以下是关键配置步骤的图文说明。</p><ul><li><p><strong>操作系统类型与命名</strong><br><img src="/img/PixPin_2025-08-13_15-55-50.png" alt="操作系统类型选择"><br><img src="/img/PixPin_2025-08-13_15-56-18.png" alt="虚拟机命名"></p></li><li><p><strong>处理器与内存</strong></p><blockquote><p>分配的核心总数<strong>不要超过</strong>您电脑的逻辑处理器上限。内存建议分配 <strong>4GB 或以上</strong>。<br><img src="/img/PixPin_2025-08-13_15-57-14.png" alt="处理器配置"><br><img src="/img/PixPin_2025-08-13_15-59-43.png" alt="内存配置"><br><img src="/img/PixPin_2025-08-13_16-54-27.png" alt="虚拟机设置"></p></blockquote></li><li><p><strong>硬盘</strong></p><blockquote><p>选择“创建新的虚拟磁盘”，建议容量为 <strong>50GB 或以上</strong>。<br><img src="/img/PixPin_2025-08-13_16-01-47.png" alt="硬盘配置"><br>因为我们是新建的虚拟机，所以选择创建新磁盘，而不是使用现有磁盘。<br><img src="/img/PixPin_2025-08-13_16-02-14.png" alt="创建新磁盘"><br><img src="/img/PixPin_2025-08-13_16-03-25.png" alt="磁盘容量设置"></p></blockquote></li><li><p><strong>完成创建</strong></p><blockquote><p>后续步骤若无特殊需求，保持默认推荐选项即可。<br><img src="/img/PixPin_2025-08-13_16-04-21.png" alt="完成虚拟机创建"><br><img src="/img/PixPin_2025-08-13_16-05-42.png" alt="虚拟机创建完成"></p></blockquote></li><li><p><strong>加载ISO并启动</strong></p><blockquote><p>在虚拟机设置中，将下载好的 Arch Linux ISO 文件加载到虚拟光驱中，然后启动虚拟机。<br><img src="/img/PixPin_2025-08-13_18-15-07.png" alt="加载ISO文件"></p></blockquote></li></ul><blockquote><p><strong>注意：</strong> 启动时如果出现如下提示，点击“否”即可。<br><img src="/img/PixPin_2025-08-13_16-59-37.png" alt="启动提示"></p></blockquote><p>完成以上设置后，启动虚拟机。</p><hr><h2 id="二、系统安装"><a href="#二、系统安装" class="headerlink" title="二、系统安装"></a>二、系统安装</h2><h3 id="步骤-1：启动进入安装环境"><a href="#步骤-1：启动进入安装环境" class="headerlink" title="步骤 1：启动进入安装环境"></a>步骤 1：启动进入安装环境</h3><p>启动虚拟机后，会看到一个启动菜单。选择第一个选项 <code>Arch Linux install medium</code>，系统将自动加载并进入一个临时的命令行安装环境。</p><p><img src="/img/PixPin_2025-08-13_16-19-47.png" alt="Arch Linux 启动菜单"></p><h3 id="步骤-2：验证网络连接"><a href="#步骤-2：验证网络连接" class="headerlink" title="步骤 2：验证网络连接"></a>步骤 2：验证网络连接</h3><p>Arch Linux 的安装过程需要网络连接。在虚拟机中，网络通常会自动配置好。您可以通过 <code>ping</code> 命令来测试网络连通性：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping archlinux.org</span><br></pre></td></tr></table></figure><blockquote><p>如果能收到来自服务器的回复 (reply)，则说明网络正常。按 <code>Ctrl+C</code> 可以停止 <code>ping</code> 命令。</p></blockquote><h3 id="步骤-3：磁盘分区-cfdisk"><a href="#步骤-3：磁盘分区-cfdisk" class="headerlink" title="步骤 3：磁盘分区 (cfdisk)"></a>步骤 3：磁盘分区 (<code>cfdisk</code>)</h3><p>这是整个安装过程中最关键也最容易出错的一步。我们将使用 <code>cfdisk</code> 这个相对友好的工具来为虚拟硬盘分区。</p><p>在终端中输入以下命令启动分区工具：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cfdisk /dev/sda</span><br></pre></td></tr></table></figure><h4 id="3-1-选择分区表类型"><a href="#3-1-选择分区表类型" class="headerlink" title="3.1 选择分区表类型"></a>3.1 选择分区表类型</h4><blockquote><p><code>cfdisk</code> 首先会要求您选择分区表类型。对于现代计算机和UEFI启动，<strong><code>gpt</code> 是唯一正确的选择</strong>。直接按回车键确认即可。</p></blockquote><p><img src="/img/PixPin_2025-08-13_16-14-09.png" alt="选择分区表类型"></p><h4 id="3-2-创建分区"><a href="#3-2-创建分区" class="headerlink" title="3.2 创建分区"></a>3.2 创建分区</h4><blockquote><p>您现在会看到 <code>cfdisk</code> 的主界面。我们将创建两个最核心的分区：一个用于启动 (EFI)，一个用于存放系统 (根分区)。</p></blockquote><p><img src="/img/PixPin_2025-08-13_16-15-54.png" alt="cfdisk 主界面"></p><p><strong>第一步：创建 EFI 启动分区</strong></p><p>这个分区是启动系统所必需的。</p><ol><li>确保 <code>&gt;&gt; Free space</code> (空闲空间) 这一行被选中（它默认就是选中的）。</li><li>在键盘上，使用左右箭头键移动到屏幕下方的 <strong><code>[ New ]</code></strong> 选项上，然后按 <strong>回车 (Enter)</strong> 键。</li><li>它会提示您输入分区大小 <code>Partition size</code>。请输入 <code>512M</code> 然后按 <strong>回车</strong>。（512MB 对于启动分区来说绰绰有余）。</li><li>创建后，您会看到一个新的分区 <code>/dev/sda1</code>。现在需要把它标记为启动分区。确保 <code>/dev/sda1</code> 这一行被选中，然后移动到下方的 <strong><code>[ Type ]</code></strong> 选项，按 <strong>回车</strong>。</li><li>在弹出的类型列表中，使用上下箭头键找到并选中 <strong><code>EFI System</code></strong>，然后按 <strong>回车</strong>。</li></ol><blockquote><p>做完这一步，您的屏幕看起来应该像这样： <code>Device Size Type</code> <code>/dev/sda1 512M EFI System</code></p></blockquote><p><strong>第二步：创建根 (Root) 分区</strong></p><p>这个分区用来存放整个操作系统。</p><ol><li>使用向下箭头键，选中剩下的那一行 <code>Free space</code> (大约 49.5G)。</li><li>和刚才一样，移动到下方的 <strong><code>[ New ]</code></strong> 并按 <strong>回车</strong>。</li><li>它会再次提示输入分区大小。这次我们想用掉所有剩余空间，所以<strong>直接按回车</strong>即可，不需要输入任何数字。</li><li>创建后，您会看到第二个分区 <code>/dev/sda2</code>。它的默认类型 <code>Linux filesystem</code> 就是我们想要的，<strong>无需更改</strong>。</li></ol><p><strong>第三步：保存并写入更改 (最关键!)</strong></p><p>到目前为止，所有的操作都还只是预演。必须执行“写入”操作才会真正生效。</p><ol><li>移动到屏幕下方的 <strong><code>[ Write ]</code></strong> 选项，按 <strong>回车</strong>。</li><li>它会用英文警告您，这个操作会把分区表写入磁盘。它会问 <code>Are you sure you want to write the partition table to disk?</code> (您确定要把分区表写入磁盘吗？)。</li><li><strong>输入 <code>yes</code></strong> 然后按 <strong>回车</strong> 确认。</li></ol><p><img src="/img/PixPin_2025-08-13_16-17-29.png" alt="写入分区表确认"></p><blockquote><p>当您完成以上所有步骤后，您的分区方案如下：</p><table><thead><tr><th>分区 (设备)</th><th>大小 (Size)</th><th>类型 (Type)</th><th>用途</th></tr></thead><tbody><tr><td><code>/dev/sda1</code></td><td>512M</td><td>EFI System</td><td><strong>启动分区</strong> (存放引导程序)</td></tr><tr><td><code>/dev/sda2</code></td><td>约 49.5G</td><td>Linux 文件系统</td><td><strong>根分区</strong> (存放操作系统)</td></tr></tbody></table></blockquote><p><strong>第四步：退出分区工具</strong></p><ol><li>移动到屏幕下方的 <strong><code>[ Quit ]</code></strong> 选项，按 <strong>回车</strong>。</li><li>您将会退出 <code>cfdisk</code> 工具，并返回到黑色的命令行界面。</li></ol><h3 id="步骤-4：格式化分区和挂载"><a href="#步骤-4：格式化分区和挂载" class="headerlink" title="步骤 4：格式化分区和挂载"></a>步骤 4：格式化分区和挂载</h3><p>分区完成后，需要对它们进行格式化，然后挂载到指定目录。</p><ul><li><p><strong>格式化 EFI 分区:</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkfs.fat -F32 /dev/sda1</span><br></pre></td></tr></table></figure></li><li><p><strong>格式化根分区:</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkfs.ext4 /dev/sda2</span><br></pre></td></tr></table></figure><blockquote><p><strong>关于交换空间 (Swap) 怎么办？</strong><br>您不用担心。我们可以在系统安装完成之后，在根分区里创建一个<code>swapfile</code>（交换文件），这是比创建独立 <code>swap</code> 分区更现代、更灵活的方式。<strong>现在请先不要处理 swap 的问题。</strong></p></blockquote></li></ul><p>接下来，开始挂载。</p><p><strong>第一步：挂载根分区</strong></p><blockquote><p>这个命令告诉系统，<code>/mnt</code> 目录就是我们即将安装的 Arch Linux 的根目录 (<code>/</code>)。</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/sda2 /mnt</span><br></pre></td></tr></table></figure><blockquote><p>（执行这条命令后，如果没报错，就说明成功了）</p></blockquote><p><strong>第二步：创建启动挂载点</strong></p><blockquote><p>在刚刚挂载好的根目录里，创建一个叫 <code>boot</code> 的文件夹。</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /mnt/boot</span><br></pre></td></tr></table></figure><p><strong>第三步：挂载 EFI 启动分区</strong></p><blockquote><p>将您的 EFI 启动分区 (<code>/dev/sda1</code>) 挂载到刚刚创建的 <code>/mnt/boot</code> 目录上。</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/sda1 /mnt/boot</span><br></pre></td></tr></table></figure><p><strong>第四步：检查挂载状态</strong></p><blockquote><p>当您完成以上<strong>全部三步</strong>操作后，可以输入以下命令来检查挂载状态：</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsblk</span><br></pre></td></tr></table></figure><blockquote><p>您应该会看到类似下面的输出，<code>sda1</code> 和 <code>sda2</code> 都有了对应的 <code>MOUNTPOINT</code> (挂载点)：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS</span><br><span class="line">sda      8:0    0   50G  0 disk</span><br><span class="line">├─sda1   8:1    0  512M  0 part /mnt/boot</span><br><span class="line">└─sda2   8:2    0 49.5G  0 part /mnt</span><br></pre></td></tr></table></figure><p>如果您的输出和这个结构类似，就说明挂载圆满成功，您可以进行下一步了。</p></blockquote><h3 id="步骤-5：更新镜像列表（可选但推荐）"><a href="#步骤-5：更新镜像列表（可选但推荐）" class="headerlink" title="步骤 5：更新镜像列表（可选但推荐）"></a>步骤 5：更新镜像列表（可选但推荐）</h3><p>为了在安装基本系统时获得更快的下载速度，建议先更新软件源镜像列表，优先使用国内的服务器。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reflector --verbose --country China --age 12 --protocol https --<span class="built_in">sort</span> rate --latest 6 --save /etc/pacman.d/mirrorlist</span><br></pre></td></tr></table></figure><h3 id="步骤-6：安装基本系统-pacstrap"><a href="#步骤-6：安装基本系统-pacstrap" class="headerlink" title="步骤 6：安装基本系统 (pacstrap)"></a>步骤 6：安装基本系统 (<code>pacstrap</code>)</h3><p>现在，我们使用 <code>pacstrap</code> 命令将 Arch Linux 的核心软件包安装到刚刚挂载好的根分区 (<code>/mnt</code>) 中。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacstrap -K /mnt base linux linux-firmware</span><br></pre></td></tr></table></figure><blockquote><p><strong>关于安装过程中的警告信息：</strong><br>您可能会在屏幕上看到许多黄色的 <code>WARNING: Possibly missing firmware for module: ...</code> 信息。</p><ul><li><strong>这是什么？</strong> 这是因为 <code>linux-firmware</code> 包包含了海量硬件的固件，而安装程序检测到您的虚拟机环境并不需要其中大部分（例如服务器专用网卡的固件）。</li><li><strong>需要处理吗？</strong> <strong>完全不需要。</strong> 这些警告是正常现象，可以安全地忽略，对您的系统没有任何影响。</li></ul></blockquote><hr><h2 id="三、系统配置"><a href="#三、系统配置" class="headerlink" title="三、系统配置"></a>三、系统配置</h2><h3 id="步骤-1：进入新系统-arch-chroot"><a href="#步骤-1：进入新系统-arch-chroot" class="headerlink" title="步骤 1：进入新系统 (arch-chroot)"></a>步骤 1：进入新系统 (<code>arch-chroot</code>)</h3><p>安装完基本系统后，我们需要进入到这个新系统中进行配置。<code>arch-chroot</code> 命令可以让我们仿佛“登录”到 <code>/mnt</code> 目录下的新系统里。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arch-chroot /mnt</span><br></pre></td></tr></table></figure><blockquote><p><strong>关键变化：</strong> 执行此命令后，您会发现命令提示符从 <code>root@archiso ~ #</code> 变成了 <code>[root@archiso /]#</code>。这个变化标志着您已经成功进入了硬盘上的新系统。从现在起，所有命令都将直接作用于您的系统。</p></blockquote><h3 id="步骤-2：设置时区"><a href="#步骤-2：设置时区" class="headerlink" title="步骤 2：设置时区"></a>步骤 2：设置时区</h3><p>将系统时区设置为上海，并同步硬件时钟。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br><span class="line">hwclock --systohc</span><br></pre></td></tr></table></figure><h3 id="步骤-3：本地化-Localization"><a href="#步骤-3：本地化-Localization" class="headerlink" title="步骤 3：本地化 (Localization)"></a>步骤 3：本地化 (Localization)</h3><p>此步骤用于配置系统的语言和字符集。</p><ol><li><p><strong>安装文本编辑器:</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -S nano</span><br></pre></td></tr></table></figure></li><li><p><strong>编辑 <code>/etc/locale.gen</code> 文件:</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/locale.gen</span><br></pre></td></tr></table></figure><blockquote><p>在 <code>nano</code> 编辑器中，您需要找到并取消注释（即删除行首的 <code>#</code>）以下两行：</p><ul><li><code>en_US.UTF-8 UTF-8</code></li><li><code>zh_CN.UTF-8 UTF-8</code></li></ul><p><strong>Nano 操作技巧：</strong></p><ul><li>使用 <code>Ctrl + W</code> 搜索关键字（如 <code>en_US.UTF-8</code>）。</li><li>使用方向键和退格键删除 <code>#</code>。</li><li>完成后，按 <code>Ctrl + X</code> 退出，程序会提示是否保存，按 <code>Y</code> 确认，然后按回车键确认文件名。</li></ul></blockquote></li><li><p><strong>生成 Locale:</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">locale-gen</span><br></pre></td></tr></table></figure></li><li><p><strong>创建 <code>locale.conf</code> 文件:</strong><br>此文件用于设定系统的默认语言。这里我们设为美式英语。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;LANG=en_US.UTF-8&quot;</span> &gt; /etc/locale.conf</span><br></pre></td></tr></table></figure></li></ol><h3 id="步骤-4：设置主机名"><a href="#步骤-4：设置主机名" class="headerlink" title="步骤 4：设置主机名"></a>步骤 4：设置主机名</h3><p>主机名是您的计算机在网络中的名字。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;my-arch-vm&quot;</span> &gt; /etc/hostname</span><br></pre></td></tr></table></figure><blockquote><p>您可以将 <code>my-arch-vm</code> 替换为您喜欢的任何名字。</p></blockquote><h3 id="步骤-5：设置-Root-用户密码"><a href="#步骤-5：设置-Root-用户密码" class="headerlink" title="步骤 5：设置 Root 用户密码"></a>步骤 5：设置 Root 用户密码</h3><p><code>root</code> 是系统的超级管理员用户，必须为其设置一个安全的密码。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd</span><br></pre></td></tr></table></figure><blockquote><p>按照提示，输入两次新密码。注意，输入时屏幕不会有任何显示，这是正常的安全机制。</p></blockquote><h3 id="步骤-6：安装并配置引导加载程序-GRUB"><a href="#步骤-6：安装并配置引导加载程序-GRUB" class="headerlink" title="步骤 6：安装并配置引导加载程序 (GRUB)"></a>步骤 6：安装并配置引导加载程序 (GRUB)</h3><p>引导加载程序（Bootloader）是开机时第一个运行的软件，负责加载操作系统。</p><ol><li><strong>安装 GRUB 和相关工具:</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -S grub efibootmgr</span><br></pre></td></tr></table></figure></li><li><strong>部署 GRUB 到 EFI 分区:</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=GRUB</span><br></pre></td></tr></table></figure></li><li><strong>生成 GRUB 配置文件:</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grub-mkconfig -o /boot/grub/grub.cfg</span><br></pre></td></tr></table></figure></li></ol><hr><h2 id="四、完成安装与首次启动"><a href="#四、完成安装与首次启动" class="headerlink" title="四、完成安装与首次启动"></a>四、完成安装与首次启动</h2><h3 id="步骤-1：退出-Chroot-环境并关机"><a href="#步骤-1：退出-Chroot-环境并关机" class="headerlink" title="步骤 1：退出 Chroot 环境并关机"></a>步骤 1：退出 Chroot 环境并关机</h3><p>所有配置已完成。现在可以安全地退出并关机了。</p><ol><li><p><strong>退出 Chroot:</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure><blockquote><p>此时，命令提示符会恢复为 <code>root@archiso ~ #</code>。</p></blockquote></li><li><p><strong>卸载分区:</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umount -R /mnt</span><br></pre></td></tr></table></figure></li><li><p><strong>关机:</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shutdown now</span><br></pre></td></tr></table></figure></li></ol><h3 id="步骤-2：移除-ISO-并重启"><a href="#步骤-2：移除-ISO-并重启" class="headerlink" title="步骤 2：移除 ISO 并重启"></a>步骤 2：移除 ISO 并重启</h3><p>在虚拟机完全关机后，<strong>务必在虚拟机设置中移除或断开 ISO 镜像文件</strong>，否则下次开机又会进入安装环境。</p><p>完成此操作后，重新启动虚拟机。</p><h3 id="步骤-3：登录新系统"><a href="#步骤-3：登录新系统" class="headerlink" title="步骤 3：登录新系统"></a>步骤 3：登录新系统</h3><p>如果一切顺利，您将看到黑色的命令行登录界面。</p><ol><li><strong>输入用户名:</strong> 在 <code>login:</code> 提示符后，输入 <code>root</code>，按回车。</li><li><strong>输入密码:</strong> 输入您之前为 <code>root</code> 用户设置的密码，按回车。</li></ol><p>成功登录后，您将看到 <code>[root@my-arch-vm ~]#</code> 这样的命令提示符。</p><p><strong>恭喜！您已成功安装并登录了您亲手打造的 Arch Linux 系统。</strong></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Arch Linux </tag>
            
            <tag> 虚拟机 </tag>
            
            <tag> Linux安装 </tag>
            
            <tag> VMware </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
